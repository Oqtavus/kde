#!/bin/bash

step () {
    echo -e "\e[1;35m==> $1\e[0m"
}

#-------------------------------------------------------------------------------
step 'Timezone'
#-------------------------------------------------------------------------------

ln -sf /usr/share/zoneinfo/Europe/Kiev /etc/localtime

#-------------------------------------------------------------------------------
step 'Clock'
#-------------------------------------------------------------------------------

hwclock --systohc

#-------------------------------------------------------------------------------
step 'Locale'
#-------------------------------------------------------------------------------

sed -i 's/#ru_RU.UTF-8/ru_RU.UTF-8/' /etc/locale.gen
locale-gen

#-------------------------------------------------------------------------------
step 'Lang'
#-------------------------------------------------------------------------------

echo 'LANG=ru_RU.UTF-8' > /etc/locale.conf

#-------------------------------------------------------------------------------
step 'Font'
#-------------------------------------------------------------------------------

echo 'FONT=UniCyr_8x16' > /etc/vconsole.conf

#-------------------------------------------------------------------------------
step 'Name'
#-------------------------------------------------------------------------------

echo 'desktop' > /etc/hostname
echo '127.0.0.1 desktop.localdomain desktop' >> /etc/hosts

#-------------------------------------------------------------------------------
step 'Initcpio'
#-------------------------------------------------------------------------------

mkinitcpio -p linux-zen

#-------------------------------------------------------------------------------
step 'Root password'
#-------------------------------------------------------------------------------

passwd

#-------------------------------------------------------------------------------
step 'User'
#-------------------------------------------------------------------------------

useradd -m -g users -G wheel -s /bin/bash qtm

#-------------------------------------------------------------------------------
step 'User password'
#-------------------------------------------------------------------------------

passwd qtm

#-------------------------------------------------------------------------------
step 'Sudoers'
#-------------------------------------------------------------------------------

sed -i 's/# %wheel ALL=(ALL) ALL/%wheel ALL=(ALL) ALL/' /etc/sudoers

#-------------------------------------------------------------------------------
step 'Systemd-Boot'
#-------------------------------------------------------------------------------

bootctl install
mkdir -p /etc/pacman.d/hooks
echo -e "timeout 5\ndefault arch" > /boot/loader/loader.conf
echo -e "title ArchLinux\nlinux /vmlinuz-linux-zen\ninitrd /initramfs-linux-zen.img\noptions root=LABEL=ROOT rw" > /boot/loader/entries/arch.conf
echo -e "[Trigger]\nType = Package\nOperation = Upgrade\nTarget = systemd\n\n[Action]\nDescription = Updating systemd-boot\nWhen = PostTransaction\nExec = /usr/bin/bootctl update" > /etc/pacman.d/hooks/100-systemd-boot.hook

#-------------------------------------------------------------------------------
step 'Network'
#-------------------------------------------------------------------------------

systemctl enable NetworkManager.service

#-------------------------------------------------------------------------------
step 'Done!'
#-------------------------------------------------------------------------------
